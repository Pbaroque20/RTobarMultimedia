<body style="background-color: #1D5F89;">
    <div id="portraitOnlyOverlay" aria-hidden="true"><p>Please rotate your device to portrait mode to view this website.</p></div>
    <div class="wrapper session-page">
        <div id="overlay"></div>
        <div class="imageContainer2">
            <header>
                <div id="topHeader">
                    <div>Tobar<span class="multi">MediaDesign</span></div>
                    <div id="copyright-year">©2026</div>
                </div>
            </header>
            <main>
                <section>
                    <div class="portfolioblocks"></div>
                    <div id="lightbox"><div id="closelightbox">PRESS WINDOW TO CLOSE</div><div id="lightboxLoader" style="display:none;"><img id="lightboxLoaderGif" src="loader/white_loader.gif" alt="" /><span id="lightboxLoaderPct">0%</span></div><img id="changeImg" /><div id="inform"></div></div>
                    <div id="videoLightboxWrap">
                        <div id="close">CLOSE WINDOW</div>
                        <div class="video-player-wrap">
                            <iframe id="videobox" webkitallowfullscreen mozallowfullscreen allowfullscreen></iframe>
                            <video id="localVideo" controls preload="none">
                                Your browser does not support the video tag.
                            </video>
                            <div id="videoInform"></div>
                        </div>
                    </div>
                    <div class="birth"><img style="cursor:pointer;" class="workimg" id="birth" src="images/birth.png" /></div>
                    <div class="ances"><img style="cursor:pointer;" class="workimg" id="ances" src="images/ances.png" /></div>
                    <div class="contactus2"><img style="cursor:pointer;" class="workimg" id="contactus2" src="images/contactus2.png" /></div>
                    <div class="min"><img style="cursor:pointer;" class="workimg" id="min" src="images/30min.png" /></div>
                    <div class="contactus2gameplay"><img style="cursor:pointer;" class="workimg" id="contactus2gameplay" src="images/contactus2gameplay.png" /></div>
                    <div class="beaver"><img style="cursor:pointer;" class="workimg" id="beaver" src="images/beaver.png" /></div>
                    <div class="essence"><img style="cursor:pointer;" class="workimg" id="essence" src="images/colli.png" /></div>
                    <div class="tomi"><img style="cursor:pointer;" class="workimg" id="tomi" src="images/tomi.png" /></div>
                    <div class="bomb"><img style="cursor:pointer;" class="workimg" id="bomb" src="images/bomb.png" /></div>
                    <div class="fortstandard"><img style="cursor:pointer;" class="workimg" id="fortstandard" src="images/FS.png" /></div>
                    <div class="lifeisjazz"><img style="cursor:pointer;" class="workimg" id="lifeisjazz" src="images/lifeisjazz.png" /></div>
                    <div class="kitchen"><img style="cursor:pointer;" class="workimg" id="kitchen" src="images/archviz.png" /></div>
                    <div class="mirror"><img style="cursor:pointer;" class="workimg" id="mirror" src="images/mirror.png" /></div>
                    <div class="work2020"><img style="cursor:pointer;" class="workimg" id="2020" src="images/2020.png" /></div>
                    <div class="rw"><img style="cursor:pointer;" class="workimg" id="rw" src="images/rw.png" /></div>
                    <div class="eledonkey2020"><img style="cursor:pointer;" class="workimg" id="eledonkey2020" src="images/2020eledonkey.png" /></div>
                    <div class="surgeons"><img style="cursor:pointer;" class="workimg" id="surgeons" src="images/surgeons.png" /></div>
                    <div class="vaniads"><img style="cursor:pointer;" class="workimg" id="vaniads" src="images/vaniads.png" /></div>
                    <div class="NA"><img style="cursor:pointer;" class="workimg" id="NA" src="images/NA.png" /></div>
                    <div class="giphy"><img style="cursor:pointer;" class="workimg" id="giphy" src="images/giphy.png" /></div>
                </section>
            </main>
        </div>
        <nav class="nav_page2">
            <ul>
                <li><a class="genesis">genesis</a></li>
                <li><a style="color: #F3E60F;cursor:default;">session</a></li>
                <li><a class="narrative">narrative</a></li>
                <li><a class="connect">connect</a></li>
            </ul>
        </nav>
        <div id="demoreel"><a id="demoreellink">2013 Motion Graphics Demo Reel</a></div>
    </div>
    <div id="sessionPanHint" aria-live="polite">Pan screen with drag</div>
    <script>
        $(document).ready(function () {
            SiteUtils.updateCopyrightYear();
            
            // Disable image dragging on workimgs globally
            $('.workimg img').attr('draggable', 'false').on('dragstart', function(e) {
                e.preventDefault();
                return false;
            });

            // Click-drag panning for desktop when window is resized below 960px
            var hasTouch = 'ontouchstart' in window || navigator.maxTouchPoints > 0;
            // Desktop = has mouse capability (not mobile/tablet)
            var isMobileDevice = hasTouch && window.innerWidth <= 768 && /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
            var isDesktop = !isMobileDevice;
            var isDragging = false;
            var hasDragged = false; // Track if user actually dragged (moved mouse) - accessible globally
            var startX = 0;
            var scrollLeft = 0;
            var dragThreshold = 5; // Pixels to move before considering it a drag
            var $wrapper = null;
            var panStartTarget = null; // Track what element was clicked for pan start
            
            function setupDragPanning() {
                $wrapper = $('.wrapper.session-page');
                var windowWidth = window.innerWidth;
                
                // Remove any existing handlers first
                $wrapper.off('mousedown.pan');
                $(document).off('mousemove.pan mouseup.pan');
                
                // Only enable for desktop when window is small
                if (windowWidth <= 959 && isDesktop && $wrapper.length) {
                    // Make sure wrapper is scrollable
                    var wrapperEl = $wrapper[0];
                    if (wrapperEl.scrollWidth <= wrapperEl.clientWidth) {
                        return;
                    }
                    
                    $wrapper.on('mousedown.pan', function(e) {
                        var $target = $(e.target);
                        var tagName = e.target.tagName.toLowerCase();
                        
                        // Don't start pan if clicking on interactive elements (except workimg - handled separately)
                        if (tagName === 'a' || tagName === 'button' ||
                            $target.closest('#lightbox, #videoLightboxWrap, #overlay, nav, #close, #closelightbox, #demoreel').length) {
                            return true;
                        }
                        
                        // Store the target for later check
                        panStartTarget = e.target;
                        isDragging = false;
                        hasDragged = false;
                        startX = e.pageX;
                        scrollLeft = wrapperEl.scrollLeft;
                        
                        // If clicking on workimg, prevent image drag but allow click if no movement
                        if ($target.closest('.workimg').length) {
                            // Prevent image dragging - stop default drag behavior
                            e.preventDefault();
                            e.stopPropagation();
                            // Disable drag on images immediately
                            $('.workimg img').attr('draggable', 'false');
                            $('.workimg img').off('dragstart.pan').on('dragstart.pan', function(e) {
                                e.preventDefault();
                                e.stopPropagation();
                                return false;
                            });
                            return false; // Prevent default to stop image drag
                        }
                        
                        // For other areas, prepare for drag
                        $wrapper.css({
                            'cursor': 'grabbing',
                            'user-select': 'none'
                        });
                        e.preventDefault();
                        e.stopPropagation();
                        return false;
                    });
                    
                    $(document).on('mousemove.pan', function(e) {
                        if (panStartTarget === null) return;
                        
                        var deltaX = Math.abs(e.pageX - startX);
                        
                        // If moved more than threshold, it's a drag
                        if (deltaX > dragThreshold) {
                            hasDragged = true;
                            isDragging = true;
                            
                            var $target = $(panStartTarget);
                            var scrollDelta = e.pageX - startX;
                            
                            // Disable selection on workimgs when dragging
                            if ($target.closest('.workimg').length) {
                                $('.workimg').css({
                                    'user-select': 'none',
                                    '-webkit-user-select': 'none',
                                    '-moz-user-select': 'none',
                                    '-ms-user-select': 'none',
                                    'pointer-events': 'none' // Prevent image drag
                                });
                            }
                            
                            // Perform pan (works for both workimg and other areas)
                            wrapperEl.scrollLeft = scrollLeft - (scrollDelta * 2);
                            $wrapper.css({
                                'cursor': 'grabbing',
                                'user-select': 'none'
                            });
                            e.preventDefault();
                            e.stopPropagation();
                            return false;
                        }
                    });
                    
                    $(document).on('mouseup.pan', function(e) {
                        if (panStartTarget !== null) {
                            // Re-enable selection on workimgs
                            $('.workimg').css({
                                'user-select': '',
                                '-webkit-user-select': '',
                                '-moz-user-select': '',
                                '-ms-user-select': '',
                                'pointer-events': ''
                            });
                            
                            // Reset cursor immediately
                            $wrapper.css({
                                'cursor': 'grab',
                                'user-select': ''
                            });
                            
                            // Reset states after a small delay to allow click event to check hasDragged
                            setTimeout(function() {
                                isDragging = false;
                                hasDragged = false;
                                panStartTarget = null;
                            }, 50);
                        }
                    });
                    
                    // Disable image dragging on workimgs
                    $('.workimg img').attr('draggable', 'false').on('dragstart', function(e) {
                        e.preventDefault();
                        return false;
                    });
                    
                    // Show grab cursor on hover - but not on workimg
                    $wrapper.css('cursor', 'grab');
                    $wrapper.find('section, main').css('cursor', 'grab');
                } else {
                    // Disable drag
                    if ($wrapper.length) {
                        $wrapper.css({
                            'cursor': '',
                            'user-select': ''
                        });
                        $wrapper.find('section, main').css('cursor', '');
                    }
                    isDragging = false;
                    hasDragged = false;
                    panStartTarget = null;
                }
            }
            
            // Initialize after a small delay to ensure DOM is ready
            setTimeout(function() {
                setupDragPanning();
            }, 100);
            
            // Update on resize
            $(window).on('resize', function() {
                setTimeout(setupDragPanning, 50);
            });
            
            // Show hint for touch devices only when window is small
            if (window.innerWidth <= 959 && hasTouch && !sessionStorage.getItem('sessionPanHintSeen')) {
                $('#sessionPanHint').addClass('session-pan-hint-visible');
                var panHintTimeout;
                function hidePanHint() {
                    $('#sessionPanHint').removeClass('session-pan-hint-visible');
                    sessionStorage.setItem('sessionPanHintSeen', '1');
                    if (panHintTimeout) clearTimeout(panHintTimeout);
                    $(document).off('touchstart pointerdown', hidePanHint);
                }
                panHintTimeout = setTimeout(hidePanHint, 4000);
                $(document).on('touchstart pointerdown', hidePanHint);
            }

            //Site navigation and animation

            SiteUtils.initNavLinks();

            if (window.innerWidth >= 960) {
                $('.nav_page2 ul li').not(':nth-child(2)').find('a').on('mouseenter', function () {
                    $(this).addClass('nav-desktop-hover');
                }).on('mouseleave', function () {
                    $(this).removeClass('nav-desktop-hover');
                });

                // Dynamic scroll stop: do not scroll past the "2013 Motion Graphics Demo Reel" block
                // Increased clamping to prevent lightboxes from overlapping the demo reel
                (function () {
                    var $stop = $('#demoreel');
                    if (!$stop.length) return;
                    var originalMaxScrollY = null;
                    function getMaxScrollY() {
                        var rect = $stop[0].getBoundingClientRect();
                        // Add extra padding (200px) to account for lightbox heights and prevent overlap
                        var extraPadding = 200;
                        var calculatedMax = rect.top + window.scrollY - window.innerHeight + extraPadding;
                        // Store the original max scroll value before any lightbox opens
                        if (originalMaxScrollY === null) {
                            originalMaxScrollY = calculatedMax;
                        }
                        // Always use the original max scroll, don't allow it to increase
                        return originalMaxScrollY;
                    }
                    function clampScroll() {
                        // Don't clamp if lightbox is open - prevent scrolling entirely instead
                        if ($('#lightbox').is(':visible') || $('#videoLightboxWrap').is(':visible')) {
                            return;
                        }
                        var maxY = getMaxScrollY();
                        if (maxY > 0 && window.scrollY > maxY) window.scrollTo(0, maxY);
                    }
                    $(window).on('scroll', clampScroll).on('resize', clampScroll);
                })();
            }
        });
        // portfolio windows and ajax – data loaded from data.json
        var info = null;

        function openVimeoVideo(vimeoId, width, height, left, top, label) {
            $('#videoLightboxWrap').css('display', window.innerWidth > 959 ? 'block' : 'block');
            $('.video-player-wrap').css({ 'position': 'absolute', 'left': left + 'px', 'top': top + 'px', 'width': width + 'px', 'paddingTop': height + 'px' });
            $('#videobox').css({ 'display': 'block', 'position': 'absolute', 'left': '0', 'top': '0', 'width': '100%', 'height': height + 'px' }).attr({ 'src': '//player.vimeo.com/video/' + vimeoId + '?title=0&amp;byline=0&amp;portrait=0', 'width': width, 'height': height, 'frameborder': 0 });
            $('#localVideo').css('display', 'none');
            $('#close').css({ 'display': 'block', 'left': left + 'px', 'top': (top - 30) + 'px' });
            $('#videoInform').text(label || '').css('display', label ? 'block' : 'none');
            $('#overlay').css('display', 'block');
        }
        function openLocalVideo(videoPath, width, height, left, top, label) {
            $('#videoLightboxWrap').css('display', window.innerWidth > 959 ? 'block' : 'block');
            $('.video-player-wrap').css({ 'position': 'absolute', 'left': left + 'px', 'top': top + 'px', 'width': width + 'px', 'paddingTop': height + 'px' });
            $('#videobox').css('display', 'none');
            var videoElement = $('#localVideo').get(0);
            $('#localVideo source').remove();
            var sourceElement = document.createElement('source');
            sourceElement.src = videoPath;
            sourceElement.type = 'video/mp4';
            videoElement.appendChild(sourceElement);
            videoElement.load();
            $('#localVideo').css({ 'display': 'block', 'position': 'absolute', 'left': '0', 'top': '0', 'width': '100%', 'height': height + 'px' });
            $('#close').css({ 'display': 'block', 'left': left + 'px', 'top': (top - 30) + 'px' });
            $('#videoInform').text(label || '').css('display', label ? 'block' : 'none');
            var playPromise = videoElement.play();
            if (playPromise !== undefined) playPromise.catch(function(err) { console.log('Video play failed:', err); });
            $('#overlay').css('display', 'block');
        }

        $('#demoreel').on('click', function () {
            openVimeoVideo(88704801, 750, 421, 105, 150, '2013 Motion Graphics Demo Reel');
        });
        $('#close').on('click', function () {
            $('#videoLightboxWrap').css('display', 'none');
            $('.video-player-wrap').css({ 'position': '', 'left': '', 'top': '', 'width': '', 'paddingTop': '' });
            $('#videoInform').text('').css('display', 'none');
            $(this).css('display', 'none');
            $('#videobox').css('display', 'none').attr('src', '');
            var localVideoEl = $('#localVideo').get(0);
            if (localVideoEl) {
                localVideoEl.pause();
                localVideoEl.currentTime = 0;
            }
            // Reset video size to default
            $('#localVideo').css({
                'display': 'none',
                'position': '',
                'width': '',
                'height': '',
                'left': '',
                'top': ''
            });
            // Reset close button position to default
            $('#close').css({
                'left': '',
                'top': ''
            });
            // Remove any existing source elements
            $('#localVideo source').remove();
            // Clear video src
            var localVideoEl = $('#localVideo').get(0);
            if (localVideoEl) {
                localVideoEl.src = '';
                localVideoEl.removeAttribute('src');
            }
            $('#overlay').css('display', 'none');
            $('#lightbox').css({ 'display': 'none', 'opacity': '1' });
            $('#lightboxLoader').hide();
            if (typeof lightboxBlobUrl !== 'undefined' && lightboxBlobUrl) {
                URL.revokeObjectURL(lightboxBlobUrl);
                lightboxBlobUrl = null;
            }
            if (window.innerWidth > 959) $('.wrapper').css('height', '1014px');
            else $('.wrapper').css('height', '');
        });

        var lightboxBlobUrl = null;
        var lightboxContentScale = 1;
        function applyFinalLightboxSize() {
            var img = $('#changeImg').get(0);
            if (!img || !img.naturalWidth) return;
            var nw = img.naturalWidth;
            var nh = img.naturalHeight;
            var displayWidth = nw > 960 ? nw * 0.7 : nw;
            var displayHeight = nh * (displayWidth / nw);
            if (displayHeight > 735) { displayWidth = displayWidth * (735 / displayHeight); displayHeight = 735; }
            if (lightboxContentScale !== 1) {
                displayWidth = Math.round(displayWidth * lightboxContentScale);
                displayHeight = Math.round(displayHeight * lightboxContentScale);
            }
            $('#changeImg').css({ 'width': displayWidth + 'px', 'height': 'auto' });
            $('#lightbox').css({
                'width': displayWidth + 'px',
                'height': 'auto',
                'left': '50%',
                'transform': 'translateX(-50%)',
                'opacity': '1'
            });
            $('#lightboxLoader').hide();
            $('#changeImg').show();
        }
        function openImageLightbox(imgUrl, informText, contentScale) {
            lightboxContentScale = (contentScale !== undefined && contentScale !== null) ? contentScale : 1;
            if (lightboxBlobUrl) {
                URL.revokeObjectURL(lightboxBlobUrl);
                lightboxBlobUrl = null;
            }
            $('#inform').text(informText);
            $('#overlay').css('display', 'block');
            $('#changeImg').css({ 'max-width': '100%', 'max-height': 'none', 'width': 'auto', 'height': 'auto', 'object-fit': 'contain' });
            $('#changeImg').off('load.lightbox');
            $('#lightbox').css({
                'display': 'block',
                'width': '320px',
                'min-width': '320px',
                'height': 'auto',
                'left': '50%',
                'top': '50px',
                'transform': 'translateX(-50%)',
                'opacity': '1'
            });
            $('#lightboxLoader').show().css('display', 'flex');
            $('#lightboxLoaderPct').text('0%');
            $('#changeImg').hide().attr('src', '');
            var xhr = new XMLHttpRequest();
            xhr.open('GET', imgUrl, true);
            xhr.responseType = 'arraybuffer';
            xhr.onprogress = function(ev) {
                if (ev.lengthComputable) {
                    var pct = Math.min(100, Math.round((ev.loaded / ev.total) * 100));
                    $('#lightboxLoaderPct').text(pct + '%');
                }
            };
            xhr.onload = function() {
                if (xhr.status !== 200) {
                    $('#lightboxLoaderPct').text('Error');
                    $('#changeImg').attr('src', imgUrl).show();
                    $('#changeImg').on('load.lightbox', function() { applyFinalLightboxSize(); });
                    $('#lightboxLoader').hide();
                    return;
                }
                var blob = new Blob([xhr.response], { type: xhr.getResponseHeader('Content-Type') || 'image/png' });
                var url = URL.createObjectURL(blob);
                lightboxBlobUrl = url;
                $('#lightboxLoaderPct').text('100%');
                $('#changeImg').attr('src', url).on('load.lightbox', function() {
                    applyFinalLightboxSize();
                });
            };
            xhr.onerror = function() {
                $('#lightboxLoaderPct').text('Error');
                $('#changeImg').attr('src', imgUrl).show();
                $('#changeImg').on('load.lightbox', function() { applyFinalLightboxSize(); });
                $('#lightboxLoader').hide();
            };
            xhr.send();
        }

        $.getJSON('data.json').done(function (data) {
            info = data;
        }).fail(function () {
            info = { information: {} };
        }).always(function () {
            var items = (info && info.session && info.session.items) ? info.session.items : {};
            $('.workimg').on('click', function (e) {
                if (window.innerWidth <= 959 && typeof hasDragged !== 'undefined' && hasDragged) {
                    e.preventDefault();
                    e.stopPropagation();
                    return false;
                }
                var id = $(this).attr('id');
                var item = items[id];
                if (!item) return;
                var label = (info && info.information && info.information[id]) ? info.information[id] : '';
                if (item.type === 'image') {
                    openImageLightbox(item.image, label, item.scale);
                    if (item.wrapperHeight) $('.wrapper').css('height', window.innerWidth > 959 ? item.wrapperHeight + 'px' : '');
                } else if (item.type === 'vimeo') {
                    openVimeoVideo(item.vimeoId, item.width, item.height, item.left, item.top, label);
                } else if (item.type === 'video') {
                    openLocalVideo(item.video, item.width, item.height, item.left, item.top, label);
                }
            });
        }); // end getJSON

        $('#lightbox').on('click', function () {
            $(this).css({ 'display': 'none', 'opacity': '1' });
            $('#overlay').css('display', 'none');
            $('#videoLightboxWrap').css('display', 'none');
            $('#close').css('display', 'none');
            $('#videobox').css('display', 'none').attr('src', '');
            $('#lightboxLoader').hide();
            if (typeof lightboxBlobUrl !== 'undefined' && lightboxBlobUrl) {
                URL.revokeObjectURL(lightboxBlobUrl);
                lightboxBlobUrl = null;
            }
            if (window.innerWidth > 959) $('.wrapper').css('height', '1014px');
            else $('.wrapper').css('height', '');
        });
        $('.imageContainer1').css('opacity', '1');
        
        // Scrambled brightness initialization effect for workimgs
        function initializeWorkimgBrightness() {
            // Check if scrambling effect has already been shown in this session
            if (sessionStorage.getItem('sessionScramblingShown')) {
                return; // Skip if already shown
            }
            
            var $workimgs = $('.workimg');
            if ($workimgs.length === 0) return;
            
            // Set transition for smooth blinking
            $workimgs.css({
                '-webkit-transition': 'filter 0.15s ease',
                '-moz-transition': 'filter 0.15s ease',
                '-ms-transition': 'filter 0.15s ease',
                '-o-transition': 'filter 0.15s ease',
                'transition': 'filter 0.15s ease'
            });
            
            // Blink effect: change brightness multiple times during 1 second
            var blinkInterval = setInterval(function() {
                $workimgs.each(function() {
                    var randomBrightness = 0.3 + Math.random() * 1.5; // Random between 0.3 and 1.8
                    $(this).css({
                        '-webkit-filter': 'brightness(' + randomBrightness + ')',
                        '-moz-filter': 'brightness(' + randomBrightness + ')',
                        '-ms-filter': 'brightness(' + randomBrightness + ')',
                        '-o-filter': 'brightness(' + randomBrightness + ')',
                        'filter': 'brightness(' + randomBrightness + ')'
                    });
                });
            }, 150); // Blink every 150ms
            
            // After 1 second, stop blinking and animate all to normal brightness (1)
            setTimeout(function() {
                clearInterval(blinkInterval);
                // Change transition to slower for final animation
                $workimgs.css({
                    '-webkit-transition': 'filter 0.8s ease',
                    '-moz-transition': 'filter 0.8s ease',
                    '-ms-transition': 'filter 0.8s ease',
                    '-o-transition': 'filter 0.8s ease',
                    'transition': 'filter 0.8s ease'
                });
                $workimgs.css({
                    '-webkit-filter': 'brightness(1)',
                    '-moz-filter': 'brightness(1)',
                    '-ms-filter': 'brightness(1)',
                    '-o-filter': 'brightness(1)',
                    'filter': 'brightness(1)'
                });
                
                // After animation completes, remove inline styles to allow CSS hover to work
                setTimeout(function() {
                    $workimgs.css({
                        '-webkit-filter': '',
                        '-moz-filter': '',
                        '-ms-filter': '',
                        '-o-filter': '',
                        'filter': '',
                        '-webkit-transition': '',
                        '-moz-transition': '',
                        '-ms-transition': '',
                        '-o-transition': '',
                        'transition': ''
                    });
                    // Mark scrambling effect as shown for this session
                    sessionStorage.setItem('sessionScramblingShown', '1');
                }, 800); // Wait for 0.8s transition to complete
            }, 1000);
        }
        
        // Initialize brightness effect after a short delay to ensure elements are visible
        setTimeout(initializeWorkimgBrightness, 100);
    </script>
</body>