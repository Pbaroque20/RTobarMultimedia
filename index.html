<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="description" content="TobarMediaDesign – Raphael Tobar's interactive multimedia portfolio. 3D & graphics generalist specializing in glTF/GLB pipelines, AR-ready assets, and marketing design. Lead 3D Artist on Webby-nominated projects. Explore work, biography, and connect." />
    <meta property="og:title" content="TobarMediaDesign" />
    <meta property="og:description" content="Raphael Tobar's interactive multimedia portfolio. 3D & graphics generalist specializing in glTF/GLB pipelines, AR-ready assets, and marketing design. Lead 3D Artist on Webby-nominated projects." />
    <meta property="og:type" content="website" />
    <meta property="og:image" content="images/page1.png" />
    <title>TobarMediaDesign</title>
    <link href="css/meyer_reset.css" rel="stylesheet" type="text/css" />
    <link href="css/index.css" rel="stylesheet" type="text/css" />
    <link href="css/fontloader.css" rel="stylesheet" type="text/css" />
    <!-- Page-specific CSS will be loaded lazily when needed -->
    <script src="js/jquery-2.1.1.min.js"></script>
    <script src="js/ajaxLoader.js"></script>
</head>
<body style="background-color:#F5E10E;">
    <header>
        <div id="topHeader">
            <div>Tobar<span class="multi">MediaDesign</span></div>
            <div id="copyright-year">©2026</div>
        </div>
    </header>
    <div id="page-content">
        <div class="loaderContainer">
            <img id="loader" src="loader/black_loader.gif" /><br />
            <span id="loading">loading 0%</span>
        </div>
    </div>
    <script>
        // Pre-load loader animation gifs immediately on page load
        (function() {
            var blackLoader = new Image();
            blackLoader.src = 'loader/black_loader.gif';
            var whiteLoader = new Image();
            whiteLoader.src = 'loader/white_loader.gif';
        })();
        
        // Pre-load Univers fonts immediately on page load
        (function() {
            // Preload Univers 55 (woff format for modern browsers)
            var univers55Link = document.createElement('link');
            univers55Link.rel = 'preload';
            univers55Link.as = 'font';
            univers55Link.type = 'font/woff';
            univers55Link.crossOrigin = 'anonymous';
            univers55Link.href = 'fonts/Univers.woff';
            document.head.appendChild(univers55Link);
            
            // Preload Univers Oblique (woff format for modern browsers)
            var universObliqueLink = document.createElement('link');
            universObliqueLink.rel = 'preload';
            universObliqueLink.as = 'font';
            universObliqueLink.type = 'font/woff';
            universObliqueLink.crossOrigin = 'anonymous';
            universObliqueLink.href = 'fonts/Univers-Oblique.woff';
            document.head.appendChild(universObliqueLink);
        })();

        // Lazy CSS loading system
        var loadedCSS = {
            genesis: false,
            session: false,
            narrative: false,
            connect: false,
            genoma: false
        };
        
        function loadPageCSS(pageName, callback) {
            if (!pageName) {
                if (callback) callback();
                return;
            }
            
            if (loadedCSS[pageName]) {
                // Already loaded
                if (callback) callback();
                return;
            }
            
            var link = document.createElement('link');
            link.rel = 'stylesheet';
            link.type = 'text/css';
            link.href = 'css/' + pageName + '.css';
            
            // For older browsers that don't support onload on link elements
            var checkLoaded = setInterval(function() {
                if (link.sheet || link.styleSheet) {
                    clearInterval(checkLoaded);
                    loadedCSS[pageName] = true;
                    if (callback) callback();
                }
            }, 10);
            
            // Modern browsers
            link.onload = function() {
                clearInterval(checkLoaded);
                loadedCSS[pageName] = true;
                if (callback) callback();
            };
            
            link.onerror = function() {
                clearInterval(checkLoaded);
                console.warn('Failed to load CSS for ' + pageName);
                loadedCSS[pageName] = true; // Mark as attempted to prevent retries
                if (callback) callback(); // Continue anyway
            };
            
            // Timeout after 5 seconds
            setTimeout(function() {
                if (!loadedCSS[pageName]) {
                    clearInterval(checkLoaded);
                    loadedCSS[pageName] = true;
                    console.warn('CSS load timeout for ' + pageName);
                    if (callback) callback(); // Continue anyway
                }
            }, 5000);
            
            document.head.appendChild(link);
        }
        
        // Promise wrapper for compatibility
        function loadPageCSSPromise(pageName) {
            if (typeof Promise !== 'undefined' && Promise.resolve) {
                return new Promise(function(resolve) {
                    loadPageCSS(pageName, resolve);
                });
            } else {
                // Fallback: use jQuery Deferred
                var dfd = $.Deferred();
                loadPageCSS(pageName, function() {
                    dfd.resolve();
                });
                return dfd.promise();
            }
        }
        
        $(document).ready(function () {
            $('#copyright-year').text('©' + new Date().getFullYear());

            // Track the highest percentage reached to prevent going backwards
            var maxLoadingPercent = 0;

            // Function to update loading percentage (only increases, never decreases)
            function updateLoadingPercentage(percent) {
                var roundedPercent = Math.round(percent);
                // Only update if the new percentage is higher than the current maximum
                if (roundedPercent > maxLoadingPercent) {
                    maxLoadingPercent = roundedPercent;
                    var $loading = $('#loading');
                    if ($loading.length) {
                        $loading.text('loading ' + maxLoadingPercent + '%');
                    }
                }
            }
            
            // Function to reset loading percentage to 0
            function resetLoadingPercentage() {
                maxLoadingPercent = 0;
                // Force update to 0%
                var $loading = $('#loading');
                if ($loading.length) {
                    $loading.text('loading 0%');
                }
            }
            
            // Helper function to trigger page-specific animations (refactored to reduce nesting)
            function triggerPageAnimations($new, $in, url) {
                var isConnectPage = url.indexOf('connect.html') !== -1;
                var isSessionPage = url.indexOf('session.html') !== -1;
                
                if (isConnectPage) {
                    triggerConnectAnimations($new);
                }
                
                if (isSessionPage && !sessionStorage.getItem('sessionScramblingShown')) {
                    $in.on('transitionend', function(e) {
                        if (e.originalEvent.propertyName === 'opacity') {
                            $in.off('transitionend');
                            triggerSessionScrambling($new);
                        }
                    });
                }
            }
            
            // Helper function for connect page chat bubble animations
            function triggerConnectAnimations($new) {
                $new.find('#chatbubble, #chatbubble2, #chatbubble3, #chatbubble4, #chatbubble5, #chatbubble6')
                    .removeClass('chatbubble_animate chatbubble2_animate chatbubble3_animate chatbubble4_animate chatbubble5_animate chatbubble6_animate');
                
                setTimeout(function() {
                    var $chatbubbles = $new.find('#chatbubble, #chatbubble2, #chatbubble3, #chatbubble4, #chatbubble5, #chatbubble6');
                    if ($chatbubbles.length > 0) {
                        $chatbubbles.css('display', 'block');
                        setTimeout(function() {
                            $new.find('#chatbubble').addClass('chatbubble_animate');
                            $new.find('#chatbubble2').addClass('chatbubble2_animate');
                            $new.find('#chatbubble3').addClass('chatbubble3_animate');
                            $new.find('#chatbubble4').addClass('chatbubble4_animate');
                            $new.find('#chatbubble5').addClass('chatbubble5_animate');
                            $new.find('#chatbubble6').addClass('chatbubble6_animate');
                        }, 50);
                    }
                }, 50);
            }
            
            // Helper function for session page scrambling animation
            function triggerSessionScrambling($new) {
                var $workimgs = $new.find('.workimg');
                if ($workimgs.length === 0) return;
                
                $workimgs.css({
                    '-webkit-transition': 'filter 0.15s ease',
                    '-moz-transition': 'filter 0.15s ease',
                    '-ms-transition': 'filter 0.15s ease',
                    '-o-transition': 'filter 0.15s ease',
                    'transition': 'filter 0.15s ease'
                });
                
                var blinkInterval = setInterval(function() {
                    $workimgs.each(function() {
                        var randomBrightness = 0.3 + Math.random() * 1.5;
                        $(this).css({
                            '-webkit-filter': 'brightness(' + randomBrightness + ')',
                            '-moz-filter': 'brightness(' + randomBrightness + ')',
                            '-ms-filter': 'brightness(' + randomBrightness + ')',
                            '-o-filter': 'brightness(' + randomBrightness + ')',
                            'filter': 'brightness(' + randomBrightness + ')'
                        });
                    });
                }, 150);
                
                setTimeout(function() {
                    clearInterval(blinkInterval);
                    $workimgs.css({
                        '-webkit-transition': 'filter 0.8s ease',
                        '-moz-transition': 'filter 0.8s ease',
                        '-ms-transition': 'filter 0.8s ease',
                        '-o-transition': 'filter 0.8s ease',
                        'transition': 'filter 0.8s ease'
                    });
                    $workimgs.css({
                        '-webkit-filter': 'brightness(1)',
                        '-moz-filter': 'brightness(1)',
                        '-ms-filter': 'brightness(1)',
                        '-o-filter': 'brightness(1)',
                        'filter': 'brightness(1)'
                    });
                    
                    setTimeout(function() {
                        $workimgs.css({
                            '-webkit-filter': '',
                            '-moz-filter': '',
                            '-ms-filter': '',
                            '-o-filter': '',
                            'filter': '',
                            '-webkit-transition': '',
                            '-moz-transition': '',
                            '-ms-transition': '',
                            '-o-transition': '',
                            'transition': ''
                        });
                        sessionStorage.setItem('sessionScramblingShown', '1');
                    }, 800);
                }, 1000);
            }

            window.navigateTo = function (url, bg) {
                $('body').css('backgroundColor', bg);
                var $pc = $('#page-content');
                var $content = $pc.children();
                var loaderTimeout;
                var showLoader = false;
                
                // Determine loader type based on URL
                var isNarrative = url.indexOf('narrative.html') !== -1;
                var isSession = url.indexOf('session.html') !== -1;
                var isGenesis = url.indexOf('genesis.html') !== -1;
                var isConnect = url.indexOf('connect.html') !== -1;
                var isGenoma = url.indexOf('genoma.html') !== -1;
                var loaderSrc = (isNarrative || isSession || isGenoma) ? 'loader/white_loader.gif' : 'loader/black_loader.gif';
                var loaderColor = (isNarrative || isSession || isGenoma) ? 'white' : 'black';
                
                // Determine which CSS to load
                var pageCSS = null;
                if (isGenesis) pageCSS = 'genesis';
                else if (isSession) pageCSS = 'session';
                else if (isNarrative) pageCSS = 'narrative';
                else if (isConnect) pageCSS = 'connect';
                else if (isGenoma) pageCSS = 'genoma';
                
                // Timer to show loader after 1 second if loading is still in progress
                loaderTimeout = setTimeout(function() {
                    showLoader = true;
                    if (!$pc.find('.loaderContainer').length) {
                        resetLoadingPercentage();
                        $pc.prepend('<div class="loaderContainer"><img id="loader" src="' + loaderSrc + '" /><br /><span id="loading" style="color:' + loaderColor + ';">loading 0%</span></div>');
                    }
                }, 1000);
                
                // Function to pre-load page background images
                function preloadPageBackground(targetPercent, callback) {
                    var backgroundImage = null;
                    
                    if (isGenesis) {
                        backgroundImage = 'images/page1.jpg';
                    } else if (isNarrative) {
                        backgroundImage = 'images/page3.jpg';
                    } else if (isConnect) {
                        backgroundImage = 'images/page4.jpg';
                    } else if (isSession) {
                        backgroundImage = 'images/page2.jpg';
                    } else if (isGenoma) {
                        backgroundImage = 'expansion/images/expansion_wires.png';
                    }
                    
                    if (!backgroundImage) {
                        if (callback) callback();
                        return;
                    }
                    
                    var img = new Image();
                    img.onload = function() {
                        updateLoadingPercentage(targetPercent);
                        if (callback) callback();
                    };
                    img.onerror = function() {
                        updateLoadingPercentage(targetPercent);
                        if (callback) callback(); // Count errors as loaded to not block forever
                    };
                    img.src = backgroundImage;
                }
                
                // Function to pre-load session workimg images and background
                function preloadSessionImages(callback) {
                    if (!isSession) {
                        callback();
                        return;
                    }
                    
                    // Include all workimg images (background already loaded via preloadPageBackground)
                    var imageSources = [
                        'images/birth.png',
                        'images/ances.png',
                        'images/contactus2.png',
                        'images/30min.png',
                        'images/contactus2gameplay.png',
                        'images/beaver.png',
                        'images/essence.png',
                        'images/experi.png',
                        'images/fish.png',
                        'images/ford.png',
                        'images/lifeisjazz.png',
                        'images/M.png',
                        'images/mirror.png',
                        'images/2020.png',
                        'images/rw.png',
                        'images/2020eledonkey.png',
                        'images/surgeons.png',
                        'images/vaniads.png',
                        'images/logodesigns.png',
                        'images/gelfenstein.png'
                    ];
                    
                    var imagesToLoad = imageSources.length;
                    var imagesLoaded = 0;
                    var startPercent = 60; // Start after background (50% HTML + 10% background = 60%)
                    var percentPerImage = (100 - startPercent) / imagesToLoad; // Remaining 40% divided by number of images
                    
                    if (imagesToLoad === 0) {
                        if (callback) callback();
                        return;
                    }
                    
                    // Update percentage as images load (jumps based on completion)
                    imageSources.forEach(function(src) {
                        var img = new Image();
                        img.onload = function() {
                            imageLoaded();
                        };
                        img.onerror = function() {
                            imageLoaded(); // Count errors as loaded to not block forever
                        };
                        img.src = src;
                    });
                    
                    function imageLoaded() {
                        imagesLoaded++;
                        // Jump to percentage based on how many images are loaded
                        var targetPercent = startPercent + (imagesLoaded / imagesToLoad) * (100 - startPercent);
                        updateLoadingPercentage(Math.min(targetPercent, 100));
                        
                        if (imagesLoaded >= imagesToLoad) {
                            // All images loaded, ensure we show 100%
                            updateLoadingPercentage(100);
                            if (callback) callback();
                        }
                    }
                }
                
                // Function to complete page load and transition
                function completePageLoad() {
                    // Clear the 1-second loader timeout since we're done loading
                    clearTimeout(loaderTimeout);
                    // Remove loader if it appeared
                    $pc.find('.loaderContainer').remove();
                    $pc.find('header').first().remove();
                    
                    // Ensure we're at 100% before removing loader
                    updateLoadingPercentage(100);
                    
                    // Remove loader
                    $pc.find('.loaderContainer').remove();
                    
                    // Remove any existing fade-in-wrap to prevent double wrapping
                    var $existingFadeIn = $('#fade-in-wrap');
                    if ($existingFadeIn.length) {
                        $existingFadeIn.children().unwrap();
                    }
                    
                    // Get content (should be direct children of $pc now, excluding loader)
                    var $new = $pc.children().not('.loaderContainer');
                    if ($new.length === 0) return; // No content to fade in
                    
                    // Make content visible (it was hidden with visibility:hidden)
                    $new.css('visibility', 'visible');
                    
                    // Wrap content
                    $new.wrapAll('<div id="fade-in-wrap"></div>');
                    var $in = $('#fade-in-wrap');
                    
                    // Set initial opacity to 0 and transition on wrapper
                    $in.css({ 'opacity': '0', 'transition': 'opacity 0.35s ease' });
                    
                    // Force reflow to ensure initial opacity: 0 is applied
                    $in[0].offsetHeight;
                    
                    // Fade in
                    requestAnimationFrame(function () {
                        $in.css('opacity', '1');
                        triggerPageAnimations($new, $in, url);
                    });
                }
                
                // Load page-specific CSS first (before content loads)
                var pageCSS = null;
                if (isGenesis) pageCSS = 'genesis';
                else if (isSession) pageCSS = 'session';
                else if (isNarrative) pageCSS = 'narrative';
                else if (isConnect) pageCSS = 'connect';
                else if (isGenoma) pageCSS = 'genoma';
                
                // Function to proceed with content loading after CSS is loaded
                function proceedWithContentLoad() {
                    if ($content.length && !$content.is('#fade-out-wrap'))
                        $content.wrapAll('<div id="fade-out-wrap"></div>');
                    var $wrap = $('#page-content #fade-out-wrap');
                    if ($wrap.length) {
                        $wrap.css('transition', 'opacity 0.3s ease');
                        $wrap[0].offsetHeight;
                        $wrap.css('opacity', '0');
                        $wrap.one('transitionend', function () {
                            $pc.empty();
                            resetLoadingPercentage();
                            loadPageContent();
                        });
                    } else {
                        $pc.empty();
                        resetLoadingPercentage();
                        loadPageContent();
                    }
                }
                
                // Helper function to load page content (refactored to reduce nesting)
                function loadPageContent() {
                    // Load HTML immediately
                    $pc.load(url, function () {
                        // Hide content immediately when loaded (before loader is removed)
                        var $loadedContent = $pc.children().not('.loaderContainer');
                        $loadedContent.css('visibility', 'hidden');
                        
                        // HTML loaded, jump to 50%
                        updateLoadingPercentage(50);
                        
                        // For connect page, prevent premature chat bubble animations
                        var isConnectPage = url.indexOf('connect.html') !== -1;
                        if (isConnectPage) {
                            // Remove animation classes that might have been added by connect.html's script
                            setTimeout(function() {
                                $loadedContent.find('#chatbubble, #chatbubble2, #chatbubble3, #chatbubble4, #chatbubble5, #chatbubble6')
                                    .removeClass('chatbubble_animate chatbubble2_animate chatbubble3_animate chatbubble4_animate chatbubble5_animate chatbubble6_animate')
                                    .css('display', 'none');
                            }, 10);
                        }
                        
                        // Pre-load page background image first (for genesis, narrative, connect, session)
                        preloadPageBackground(60, function() {
                            // Background loaded (now at 60%), now handle page-specific images
                            if (isSession) {
                                // Pre-load session workimg images
                                preloadSessionImages(function() {
                                    // Ensure we're at 100% - preloadSessionImages already sets it
                                    updateLoadingPercentage(100);
                                    // Small delay to ensure 100% is visible, then complete
                                    setTimeout(function() {
                                        completePageLoad();
                                    }, 100);
                                });
                            } else {
                                // No additional images to load, jump directly to 100%
                                updateLoadingPercentage(100);
                                // Small delay to ensure 100% is visible, then complete
                                setTimeout(function() {
                                    completePageLoad();
                                }, 100);
                            }
                        });
                    });
                }
                
                // Load CSS first, then proceed with content loading
                if (pageCSS) {
                    loadPageCSSPromise(pageCSS).then(function() {
                        proceedWithContentLoad();
                    });
                } else {
                    proceedWithContentLoad();
                }
            };

            // Pre-load genesis.html content before displaying
            var $preloadContainer = $('<div style="display:none;"></div>').appendTo('body');
            var loaderTimeout;
            var contentLoaded = false;
            
            // Timer to show loader after 1 second if initial load is still in progress
            loaderTimeout = setTimeout(function() {
                var $pc = $('#page-content');
                if (!$pc.find('.loaderContainer').length && !contentLoaded) {
                    resetLoadingPercentage();
                    $pc.html('<div class="loaderContainer"><img id="loader" src="loader/black_loader.gif" /><br /><span id="loading">loading 0%</span></div>');
                }
            }, 1000);
            
            // Reset loading percentage to 0 for initial load
            resetLoadingPercentage();
            
            // Load genesis CSS first for initial page
            loadPageCSSPromise('genesis').then(function() {
                // Load HTML immediately after CSS is loaded
                $preloadContainer.load('genesis.html', function () {
                var $preloadedContent = $preloadContainer.children();
                // Hide preloaded content initially
                $preloadedContent.css('visibility', 'hidden');
                
                // HTML loaded, jump to 50%
                updateLoadingPercentage(50);
                
                // Pre-load genesis background image first
                var bgImg = new Image();
                bgImg.onload = function() {
                    // Background loaded, jump to 60%
                    updateLoadingPercentage(60);
                    
                    // Now check for other images
                    var $images = $preloadedContent.find('img');
                    var imagesToLoad = $images.length;
                    var imagesLoaded = 0;
                    
                    if (imagesToLoad === 0) {
                        // No images, jump directly to 100%
                        updateLoadingPercentage(100);
                        displayContent();
                    } else {
                        // Wait for all images to load and jump percentage
                        var startPercent = 60;
                        var percentPerImage = (100 - startPercent) / imagesToLoad;
                        
                        $images.each(function () {
                            var $img = $(this);
                            if (this.complete) {
                                imageLoaded();
                            } else {
                                $img.on('load error', imageLoaded);
                            }
                        });
                        
                        function imageLoaded() {
                            imagesLoaded++;
                            // Jump to percentage based on how many images are loaded
                            var targetPercent = startPercent + (imagesLoaded / imagesToLoad) * (100 - startPercent);
                            updateLoadingPercentage(Math.min(targetPercent, 100));
                            
                            if (imagesLoaded >= imagesToLoad) {
                                // All images loaded, ensure we show 100%
                                updateLoadingPercentage(100);
                                displayContent();
                            }
                        }
                    }
                };
                bgImg.onerror = function() {
                    // If background fails, continue anyway at 50%
                    var $images = $preloadedContent.find('img');
                    var imagesToLoad = $images.length;
                    var imagesLoaded = 0;
                    
                    if (imagesToLoad === 0) {
                        updateLoadingPercentage(100);
                        displayContent();
                    } else {
                        var startPercent = 50;
                        var percentPerImage = (100 - startPercent) / imagesToLoad;
                        
                        $images.each(function () {
                            var $img = $(this);
                            if (this.complete) {
                                imageLoaded();
                            } else {
                                $img.on('load error', imageLoaded);
                            }
                        });
                        
                        function imageLoaded() {
                            imagesLoaded++;
                            var targetPercent = startPercent + (imagesLoaded / imagesToLoad) * (100 - startPercent);
                            updateLoadingPercentage(Math.min(targetPercent, 100));
                            
                            if (imagesLoaded >= imagesToLoad) {
                                updateLoadingPercentage(100);
                                displayContent();
                            }
                        }
                    }
                };
                bgImg.src = 'images/page1.jpg'; // Genesis background image
                
                function displayContent() {
                    contentLoaded = true;
                    // Clear the 1-second loader timeout since we're done loading
                    clearTimeout(loaderTimeout);
                    
                    // Ensure we're at 100% before removing loader
                    updateLoadingPercentage(100);
                    
                    var $pc = $('#page-content');
                    // Small delay to ensure 100% is visible, then remove loader and display content
                    setTimeout(function() {
                        // Remove loader if it appeared
                        $pc.find('.loaderContainer').remove();
                        
                        // Remove any existing fade-in-wrap
                        var $existingFadeIn = $('#fade-in-wrap');
                        if ($existingFadeIn.length) {
                            $existingFadeIn.children().unwrap();
                        }
                        
                        // Clear page content
                        $pc.empty();
                        
                        // Remove header from preloaded content
                        $preloadedContent.find('#topHeader').remove();
                        
                        // Make content visible (it was hidden)
                        $preloadedContent.css('visibility', 'visible');
                        
                        // Append content
                        $pc.append($preloadedContent);
                        
                        // Get the content we just appended
                        var $new = $pc.children();
                        if ($new.length > 0) {
                            // Wrap and set initial opacity
                            $new.wrapAll('<div id="fade-in-wrap"></div>');
                            var $in = $('#fade-in-wrap');
                            $in.css({ 'opacity': '0', 'transition': 'opacity 0.35s ease' });
                            
                            // Force reflow to ensure initial state is applied
                            $in[0].offsetHeight;
                            
                            // Fade in
                            requestAnimationFrame(function () {
                                $in.css('opacity', '1');
                            });
                        }
                        
                        $preloadContainer.remove();
                    }, 100);
                }
                });
            });
        });
    </script>
</body>
</html>